# Регламент проведения Sberbank Holdem Challenge

## Общие правила игры

- В каждой игре принимают участие 9 случайно выбранных ботов.
- Симулятор игры запускается сразу после запуска всех ботов.
- Игроки получают начальное число фишек `initial_stack`, фиксируется размер малого блайнда `small_blind_amount`.
- На каждый ход боту дается определенное количество времени `time_limit_action` (например, 0.2 секунды). Время на ход начинает отсчитываться от момента, когда симулятор запросил у бота действие.
- У каждого бота есть банк дополнительного времени в размере `time_limit_bank`. В случае, если бот не укладывается в отведенное на ход время, то начинает расходоваться время из банка.
- В случае, если у бота заканчивается время на ход и заканчивается банк дополнительного времени, то бот принудительно прекращает свою работу и считается “упавшим” (failed).
- В случае, если бот преждевременно прекращает свою работу, либо дает ответ в неверном формате, то он считается “упавшим” и отстраняется от игры.
- Упавшие (failed) боты остаются в игре, но симулятор делает за них автоматический сброс карт.
- Игра завершается, когда достигается максимальное число сыгранных раундов `max_round`, либо когда остается только один участник с фишками.

## Основной этап (офф-лайн)

Основной оффлайн-этап Sberbank Holdem Challenge будет проводится в формате хакатона на базе [Кампуса Корпоративного Университета Сбербанка](http://www.sberbank-university.ru/ru/campus/) 23 и 24 сентября, находящегося по адресу: Московская область, Истринский район, д. Аносино, ул. Университетская, вл. 11, Расстояние от МКАД — 34 км. 

- Во время основного этапа участники имеют возможность разрабатывать и отправлять своих ботов в систему.
- Проверка отправленных ботов осуществляется таким же образом, как и во время он-лайн этапа: бот участника играет 10 игр с рандомными ботами (делающими случайные действия из доступных). Проверка считается успешно пройденной, если бот участника успешно завершил все 10 игр и не упал.
- Между ботами случайных участников проводятся **непрерывный турнир**.
- Параметры игры во время проведения оффлайн этапа:
  - max_round = 50 (максимальное число раундов)
  - initial_stack = 1500 (начальное число фишек)
  - small_blind_amount = 15 (размер малого блайнда)
  - time_limit_bank = 300 сек (размер банка времени)
  - time_limit_action = 0.2 сек (время на ход)
  - Размер отправляемого архива не должен превышать 	1 ГБ.
  - Расходы по оперативной памяти не должны превышать 2 ГБ.
- Оффлайн этап завершится финальным турниром, который начинается 24 сентября в 15:00. К этому моменту отправка ботов в систему останавливается. Турнир состоит из двух частей.
- Первая часть финального турнира (отборочная) будет идти **24 сентября с 15:00 до 16:00**. В ней участвует по одному боту от каждой команды, выбирается последний успешный из отправленных в систему на момент начала турнира. Боты всех участников играют приблизительно одинаковое число игр, но не менее 30 игр для каждого из участников. После окончания первой части отбираются 9 ботов с максимальным показателем качества игры — среднего числа фишек, оставшегося к концу игры по итогам всех игр первой части. Между отобранными 9 ботами происходит финальная битва (вторая часть турнира), в ходе которой будут выявлены 3 лучшие стратегии.
- Вторая часть финального турнига (гранд-финал) будет идти **24 сентября с 16:00 до 17:00**. В ней участвуют 9 лучших ботов по итогам отборочной части финального турнира. В играх гранд-финала состав ботов не меняется, но случайно меняется расположение ботов за столом. Игры проводятся сериями из 10 последовательных игр, между которыми процессы ботов не перезагружаются. Будет создано не менее 200 игр во время гранд-финала части. После окончания второй части определяются 3 лучших бота с максимальным показателем качества игры — среднего числа фишек, оставшегося в конце игры по итогам всех игр второй части, которые объявляются победителями оффлайн этапа.
 

#### Непрерывный турнир
- В непрерывном турнире игры создаются из 9 ботов от различных участников, используются только последние отправленные решения, успешно прошедшие проверку.
- Для каждой комбинации из случайно выбранных 9 ботов проводится серия из 10 последовательных игр. Бот должен быть готов отыграть всю серию игр. 
- Порядок рассадки ботов определяется случайным образом перед каждой игрой в серии.
- Игры начинаются с момента, как в системе появляется минимум 9 успешно протестированных ботов от различных участников.
- Если стратегия завершилась с ошибкой в одной из серии игр или закончился доступный лимит времени, то в оставшейся части серии симулятор автоматически выполняет действие fold.
- Банк дополнительного времени `time_limit_bank` выдается боту на всю серию игр.
- Серия из 10 игр запускается в одном процессе. Таким образом, можно хранить информацию о играх серии в оперативной памяти или использовать доступную область на жестком диске, выделенную для решения.
- Сразу после завершения игры, участникам становится доступен лог игры в базе данных MongoDB. Логи всех игр можно использовать во время основного этапа для анализа стратегий других участников, улучшения собственной стратегии.


## Он-лайн этап

Он-лайн этап Sberbank Holdem Challenge проводится для того, чтобы участники имели возможность разобраться с интерфейсом до основной части соревнования, сделали свои первые стратегии. Кроме того, в конце он-лайн этапа происходит большой отборочный турнир, по итогам которого лучшие участники получают приглашения на основной офф-лайн этап.

#### Отправка бота в систему

- На ежедневный турнир от каждого участника выбирается самый последний бот (на момент запуска турнира), среди отправленных и успешно прошедших проверку в тестирующей системе.
- Проверка в тестирующей системе проводится следующим образом: бот участника играет 10 игр с рандомными ботами (делающими случайные действия из доступных). Проверка считается успешно пройденной, если бот участника успешно завершил все 10 игр и не упал.
Ежедневные турниры
- Во время он-лайн этапа проводятся ежедневные турниры, которые стартуют в полночь 00:00 МСК.
- В турнире участвует по одному боту от каждого участника, выбирается последний успешный из отправленных в систему на момент начала турнира.
- Боты всех участников играют приблизительно одинаковое число игр, но не менее 30 игр для каждого из участников.
- После окончания турнира участникам становится доступна таблица результатов с указанием основного показателя качества игры — среднее число фишек, оставшееся к концу игры по итогам всех игр в турнире. Кроме того, участники получают доступ к архиву с реплеями всех игр турнира.
- Параметры игры на ежедневном турнире:
  - max_round = 50 (максимальное число раундов)
  - initial_stack = 1500 (начальное число фишек)
  - small_blind_amount = 15 (размер малого блайнда)
  - time_limit_bank = 30 сек (размер банка времени)
  - time_limit_action = 0.2 сек (время на ход)

#### Отборочный турнир

- Он-лайн этап завершается отборочным турниром, который начинается 18 сентября (понедельник), в 03:00 МСК. С этого момента прием решений в систему прекращается.
- В отборочном турнире участвует по одному боту от каждого участника, выбирается последний успешный из отправленных в систему на момент начала турнира.
- Боты всех участников играют приблизительно одинаковое число игр, но не менее 60 игр для каждого из участников.
- Параметры игры на отборочном турнире совпадают с параметрами ежедневного турнира.
- После окончания турнира формируется рейтинг участников по убыванию среднего числа фишек, оставшихся у бота к концу игры, по итогам всех игр турнира.
- Участники приглашаются на основной этап по рейтингу. Участники, более высокие по рейтингу имеют более высокий приоритет в приглашении.
